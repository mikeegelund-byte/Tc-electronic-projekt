# Nova System Manager - Windows Installer

This directory contains the WiX installer project for Nova System Manager.

## Prerequisites

- .NET 8.0 SDK
- WiX Toolset v4 or later (installed via .NET tool)

## Quick Start

To install WiX toolset:
```powershell
dotnet tool install --global wix
```

To build the installer:
```powershell
.\installer\build-installer.ps1
```

## Files

- **Product.wxs** - Main WiX source file defining the package structure, features, and components
- **Components.wxs** - Auto-generated file containing all published application files (generated by build script)
- **build-installer.ps1** - PowerShell script to publish the application and build the MSI
- **output/** - Output directory for the generated MSI file (created during build)

## Build Process

The build script performs the following steps:

1. **Publish Application** - Publishes the Nova.Presentation project to `publish/` folder
2. **Check WiX Installation** - Verifies WiX toolset is installed, installs if missing
3. **Harvest Files** - Uses `wix heat` to generate Components.wxs from published files
4. **Build MSI** - Compiles Product.wxs and Components.wxs into NovaSystemManager.msi

## Manual Build Commands

If you prefer to run the commands manually:

```powershell
# 1. Publish the application
dotnet publish src/Nova.Presentation/Nova.Presentation.csproj -c Release -o publish

# 2. Harvest published files
wix heat dir publish -cg PublishedFiles -gg -scom -sfrag -srd -sreg -dr INSTALLFOLDER -var var.PublishDir -out installer/Components.wxs

# 3. Build the MSI
wix build installer/Product.wxs installer/Components.wxs -o installer/output/NovaSystemManager.msi -d PublishDir=publish
```

## Installer Features

- **Installation Directory**: `C:\Program Files\Nova System Manager\`
- **Start Menu Shortcut**: Yes (always installed)
- **Desktop Shortcut**: Optional (enabled by default, controlled via ADDDESKTOPSHORTCUT property)
- **Uninstall Support**: Yes (via Add/Remove Programs)
- **Upgrade Support**: Automatic upgrade from previous versions

## Customizing Installation

### Desktop Shortcut

The desktop shortcut is optional and enabled by default. To install without the desktop shortcut:

```cmd
msiexec /i NovaSystemManager.msi ADDDESKTOPSHORTCUT=0
```

To enable the desktop shortcut (default behavior):

```cmd
msiexec /i NovaSystemManager.msi ADDDESKTOPSHORTCUT=1
```

Or simply run the installer normally - the desktop shortcut will be created by default.

## Package Details

- **Name**: Nova System Manager
- **Manufacturer**: TC Electronic Community
- **Version**: 1.0.0.0
- **UpgradeCode**: F59429EA-DA28-4365-878A-27A1ED6F3CAE

## Testing the Installer

After building the MSI:

1. Test on a clean Windows 11 machine (or VM)
2. Run the installer and verify installation completes
3. Launch the application from Start Menu or Desktop shortcut
4. Verify the application works correctly
5. Test the uninstall process via Add/Remove Programs
6. Verify all files are removed after uninstall

## Customization

### Changing Version

Update the `Version` attribute in `Product.wxs`:
```xml
<Package Name="Nova System Manager" 
         Version="1.1.0.0"
         ...>
```

### Adding File Associations

To add .nova file association, add to Product.wxs:
```xml
<ProgId Id="NovaFile" Description="Nova System File">
  <Extension Id="nova" ContentType="application/x-nova">
    <Verb Id="open" Command="Open" TargetFile="Nova.Presentation.exe" Argument=""%1"" />
  </Extension>
</ProgId>
```

## Build Output

The build script generates:
- `installer/output/NovaSystemManager.msi` - The Windows installer package
- `installer/Components.wxs` - Auto-generated components file (git-ignored)

## Troubleshooting

### WiX not found
Install WiX toolset:
```powershell
dotnet tool install --global wix
```

### Build fails with missing files
Ensure the application is published first:
```powershell
dotnet publish src/Nova.Presentation/Nova.Presentation.csproj -c Release -o publish
```

### Permission errors during install
Run the installer as Administrator on Windows.

## References

- [WiX Toolset v4 Documentation](https://wixtoolset.org/docs/intro/)
- [WiX Toolset GitHub](https://github.com/wixtoolset/wix4)
- Project docs: `docs/09-release-installer.md`
