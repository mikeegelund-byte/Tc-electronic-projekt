<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Nova.Presentation.ViewModels"
        xmlns:views="using:Nova.Presentation.Views"
        x:Class="Nova.Presentation.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="Nova System Manager"
        Width="1000" Height="750"
        WindowStartupLocation="CenterScreen"
        Background="#2D2D2D"
        Foreground="#E0E0E0">

    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <DockPanel Margin="16">
        <!-- Status Bar at Bottom -->
        <Border DockPanel.Dock="Bottom" 
                Background="#1E1E1E" 
                Padding="8" 
                CornerRadius="4"
                Margin="0,16,0,0">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <TextBlock Grid.Column="0"
                           Text="Status: "
                           Foreground="#AAAAAA"
                           VerticalAlignment="Center"
                           FontWeight="Bold"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding StatusMessage}" 
                           Foreground="#CCCCCC"
                           VerticalAlignment="Center"
                           Margin="4,0,0,0"/>
                <ProgressBar Grid.Column="2" 
                             Value="{Binding DownloadProgress}"
                             Width="100"
                             IsVisible="{Binding IsDownloading}"
                             Margin="16,0,0,0"/>
            </Grid>
        </Border>

        <!-- Tab Control -->
        <TabControl Background="#2D2D2D">
            <!-- Connection Tab -->
            <TabItem Header="Connection">
                <ScrollViewer>
                    <StackPanel Margin="16" Spacing="16">
                        <!-- Connection Section -->
                        <Border Background="#2D2D2D" Padding="16" CornerRadius="8">
                            <StackPanel Spacing="12">
                                <TextBlock Text="MIDI Connection" 
                                           FontWeight="Bold" 
                                           FontSize="16"
                                           Foreground="#FFFFFF"/>
                                
                                <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto">
                                    <ComboBox ItemsSource="{Binding AvailablePorts}"
                                              SelectedItem="{Binding SelectedPort}"
                                              PlaceholderText="Select MIDI Port..."
                                              HorizontalAlignment="Stretch"/>
                                    
                                    <Button Grid.Column="1" 
                                            Content="ðŸ”„" 
                                            Command="{Binding RefreshPortsCommand}"
                                            ToolTip.Tip="Refresh port list"
                                            Margin="8,0,0,0"/>
                                    
                                    <Button Grid.Column="2"
                                            Content="Connect"
                                            Command="{Binding ConnectCommand}"
                                            Margin="8,0,0,0"
                                            Width="100"/>
                                </Grid>
                                
                                <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding IsConnected}">
                                    <Ellipse Width="12" Height="12" Fill="#4CAF50"/>
                                    <TextBlock Text="Connected" Foreground="#AAAAAA"/>
                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding !IsConnected}">
                                    <Ellipse Width="12" Height="12" Fill="#757575"/>
                                    <TextBlock Text="Disconnected" Foreground="#AAAAAA"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Bank Operations Section -->
                        <Border Background="#2D2D2D" Padding="16" CornerRadius="8">
                            <StackPanel Spacing="12">
                                <TextBlock Text="User Bank" 
                                           FontWeight="Bold" 
                                           FontSize="16"
                                           Foreground="#FFFFFF"/>
                                
                                <TextBlock Text="Trigger 'Send Dump' from your Nova System pedal (UTILITY â†’ MIDI â†’ Send Dump)"
                                           Foreground="#888888"
                                           TextWrapping="Wrap"/>
                                
                                <Button Content="ðŸ“¥ Download User Bank"
                                        Command="{Binding DownloadBankCommand}"
                                        HorizontalAlignment="Left"
                                        Padding="16,8"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Presets Tab -->
            <TabItem Header="Presets">
                <ScrollViewer>
                    <StackPanel Margin="16" Spacing="16">
                        <!-- Preset List View -->
                        <views:PresetListView DataContext="{Binding PresetList}" />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Settings Tab -->
            <TabItem Header="Settings">
                <ScrollViewer>
                    <StackPanel Margin="16" Spacing="16">
                        <views:SystemSettingsView />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- File Manager Tab -->
            <TabItem Header="File Manager">
                <ScrollViewer>
                    <StackPanel Margin="16" Spacing="16">
                        <views:FileManagerView />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
