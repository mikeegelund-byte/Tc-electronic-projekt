<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Nova.Presentation.ViewModels"
        xmlns:views="using:Nova.Presentation.Views"
        x:Class="Nova.Presentation.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="Nova System Manager"
        MinWidth="1200" MinHeight="700"
        Width="1400" Height="800"
        WindowStartupLocation="CenterScreen">

    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <!-- === KEYBOARD SHORTCUTS === -->
    <Window.KeyBindings>
      <KeyBinding Gesture="Ctrl+R" Command="{Binding RefreshPortsCommand}" />
      <KeyBinding Gesture="F5" Command="{Binding DownloadBankCommand}" />
      <KeyBinding Gesture="Ctrl+D" Command="{Binding DownloadBankCommand}" />
    </Window.KeyBindings>

    <DockPanel Margin="{StaticResource SpacingMedium}">
        <!-- Toolbar at Top -->
        <Border DockPanel.Dock="Top"
                Background="{StaticResource BackgroundSecondary}"
                Padding="{StaticResource SpacingSmall}"
                CornerRadius="{StaticResource BorderRadiusMedium}"
                Margin="0,0,0,16">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Grid.Column="0"
                           Text="Nova System Manager"
                           FontSize="{StaticResource FontSizeLarge}"
                           FontWeight="{StaticResource FontWeightBold}"
                           Foreground="{StaticResource TextPrimary}"
                           VerticalAlignment="Center" />
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <ToggleButton Content="ðŸŒ™"
                                  Command="{Binding ToggleThemeCommand}"
                                  ToolTip.Tip="Toggle Dark/Light theme"
                                  FontSize="18"
                                  Width="40"
                                  Height="32"
                                  AutomationProperties.Name="Toggle theme"
                                  AutomationProperties.HelpText="Switch between light and dark mode" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar at Bottom -->
        <Border DockPanel.Dock="Bottom" 
                Background="{StaticResource BackgroundPrimary}" 
                Padding="{StaticResource SpacingSmall}" 
                CornerRadius="{StaticResource BorderRadiusMedium}"
                Margin="0,16,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" 
                           Foreground="{StaticResource TextSecondary}"
                           VerticalAlignment="Center"
                           AutomationProperties.LiveSetting="Polite"
                           AutomationProperties.Name="Status message" />
                <ProgressBar Grid.Column="1" 
                             Value="{Binding DownloadProgress}"
                             Width="100"
                             Height="4"
                             IsVisible="{Binding IsDownloading}"
                             VerticalAlignment="Center"
                             Margin="16,0,0,0"
                             AutomationProperties.Name="Download progress" />
            </Grid>
        </Border>

        <!-- Main Content with Tab Control -->
        <TabControl>
            <!-- Connection Tab -->
            <TabItem Header="Connection"
                     AutomationProperties.Name="Connection and MIDI settings tab">
                <Grid ColumnDefinitions="*,16,400" RowDefinitions="*">
                    <!-- Left Side: Connection, Bank Operations, and Preset List -->
                    <StackPanel Grid.Column="0" Spacing="16">
                        <!-- Connection Section -->
                        <Border Background="{StaticResource BackgroundSecondary}" 
                                Padding="{StaticResource CardPadding}" 
                                CornerRadius="{StaticResource BorderRadiusLarge}">
                            <StackPanel Spacing="{StaticResource SpacingMedium}">
                                <TextBlock Text="MIDI Connection" 
                                           FontWeight="{StaticResource FontWeightBold}" 
                                           FontSize="{StaticResource FontSizeLarge}"
                                           Foreground="{StaticResource TextPrimary}"/>
                                
                                <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto">
                                    <ComboBox ItemsSource="{Binding AvailablePorts}"
                                              SelectedItem="{Binding SelectedPort}"
                                              PlaceholderText="Select MIDI Port..."
                                              HorizontalAlignment="Stretch"
                                              AutomationProperties.Name="MIDI port selection"
                                              AutomationProperties.HelpText="Choose a MIDI port to connect to the Nova System pedal"/>
                                    
                                    <Button Grid.Column="1" 
                                            Content="â†»"
                                            Command="{Binding RefreshPortsCommand}"
                                            ToolTip.Tip="Refresh available MIDI ports (Ctrl+R)"
                                            Margin="8,0,0,0"
                                            FontSize="18"
                                            Width="32"
                                            AutomationProperties.Name="Refresh MIDI ports"
                                            AutomationProperties.HelpText="Scan for available MIDI devices" />
                                    
                                    <Button Grid.Column="2"
                                            Content="Connect"
                                            Command="{Binding ConnectCommand}"
                                            Margin="8,0,0,0"
                                            Width="100"
                                            AutomationProperties.Name="Connect to MIDI device"
                                            AutomationProperties.HelpText="Establishes connection to selected MIDI port" />
                                </Grid>
                                
                                <!-- Connected Status -->
                                <StackPanel Orientation="Horizontal" 
                                            Spacing="8" 
                                            IsVisible="{Binding IsConnected}">
                                    <Ellipse Width="12" 
                                             Height="12" 
                                             Fill="{StaticResource StatusConnected}"
                                             VerticalAlignment="Center" />
                                    <TextBlock Text="Connected" 
                                               Foreground="{StaticResource StatusConnected}"
                                               FontWeight="{StaticResource FontWeightSemiBold}"
                                               VerticalAlignment="Center"
                                               AutomationProperties.LiveSetting="Polite" />
                                </StackPanel>
                                
                                <!-- Disconnected Status -->
                                <StackPanel Orientation="Horizontal" 
                                            Spacing="8" 
                                            IsVisible="{Binding !IsConnected}">
                                    <Ellipse Width="12" 
                                             Height="12" 
                                             Fill="{StaticResource StatusDisconnected}"
                                             VerticalAlignment="Center" />
                                    <TextBlock Text="Disconnected" 
                                               Foreground="{StaticResource TextSecondary}"
                                               VerticalAlignment="Center"
                                               AutomationProperties.LiveSetting="Polite" />
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Bank Operations Section -->
                        <Border Background="{StaticResource BackgroundSecondary}" 
                                Padding="{StaticResource CardPadding}" 
                                CornerRadius="{StaticResource BorderRadiusLarge}">
                            <StackPanel Spacing="{StaticResource SpacingMedium}">
                                <TextBlock Text="User Bank" 
                                           FontWeight="{StaticResource FontWeightBold}" 
                                           FontSize="{StaticResource FontSizeLarge}"
                                           Foreground="{StaticResource TextPrimary}"/>
                                
                                <TextBlock Text="Trigger 'Send Dump' from your Nova System pedal (UTILITY â†’ MIDI â†’ Send Dump)"
                                           Foreground="{StaticResource TextTertiary}"
                                           TextWrapping="Wrap"/>
                                
                                <Button Content="Download User Bank"
                                        Command="{Binding DownloadBankCommand}"
                                        HorizontalAlignment="Left"
                                        Padding="{StaticResource ButtonPadding}"
                                        AutomationProperties.Name="Download user bank"
                                        AutomationProperties.HelpText="Downloads all 60 presets from the Nova System pedal (F5)" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Preset List View -->
                        <views:PresetListView DataContext="{Binding PresetList}" />
                    </StackPanel>
                    
                    <!-- Right Side: Preset Detail View -->
                    <views:PresetDetailView Grid.Column="2" 
                                            DataContext="{Binding PresetDetail}" />
                </Grid>
            </TabItem>

            <!-- File Manager Tab -->
            <TabItem Header="File Manager"
                     AutomationProperties.Name="File management tab">
                <views:FileManagerView DataContext="{Binding FileManager}" />
            </TabItem>

            <!-- System Settings Tab -->
            <TabItem Header="System Settings"
                     AutomationProperties.Name="System configuration tab">
                <views:SystemSettingsView DataContext="{Binding SystemSettings}" />
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
