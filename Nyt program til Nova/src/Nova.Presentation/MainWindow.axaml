<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Nova.Presentation.ViewModels"
        xmlns:views="using:Nova.Presentation.Views"
        x:Class="Nova.Presentation.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="Nova System Manager"
        Width="1400" Height="800"
        WindowStartupLocation="CenterScreen">

    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <DockPanel Margin="16">
        <!-- Status Bar at Bottom -->
        <Border DockPanel.Dock="Bottom" 
                Background="#1E1E1E" 
                Padding="8" 
                CornerRadius="4"
                Margin="0,16,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" 
                           Foreground="#CCCCCC"
                           VerticalAlignment="Center"/>
                <ProgressBar Grid.Column="1" 
                             Value="{Binding DownloadProgress}"
                             Width="100"
                             IsVisible="{Binding IsDownloading}"
                             Margin="16,0,0,0"/>
            </Grid>
        </Border>

        <!-- Main Content with Tab Control -->
        <TabControl>
            <!-- Connection Tab -->
            <TabItem Header="ðŸ”Œ Connection">
                <Grid ColumnDefinitions="*,16,400" RowDefinitions="*">
                    <!-- Left Side: Connection, Bank Operations, and Preset List -->
                    <StackPanel Grid.Column="0" Spacing="16">
                        <!-- Connection Section -->
                        <Border Background="#2D2D2D" Padding="16" CornerRadius="8">
                            <StackPanel Spacing="12">
                                <TextBlock Text="MIDI Connection" 
                                           FontWeight="Bold" 
                                           FontSize="16"/>
                                
                                <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto">
                                    <ComboBox ItemsSource="{Binding AvailablePorts}"
                                              SelectedItem="{Binding SelectedPort}"
                                              PlaceholderText="Select MIDI Port..."
                                              HorizontalAlignment="Stretch"/>
                                    
                                    <Button Grid.Column="1" 
                                            Content="ðŸ”„" 
                                            Command="{Binding RefreshPortsCommand}"
                                            ToolTip.Tip="Refresh port list"
                                            Margin="8,0,0,0"/>
                                    
                                    <Button Grid.Column="2"
                                            Content="Connect"
                                            Command="{Binding ConnectCommand}"
                                            Margin="8,0,0,0"
                                            Width="100"/>
                                </Grid>
                                
                                <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding IsConnected}">
                                    <Ellipse Width="12" Height="12" Fill="#4CAF50"/>
                                    <TextBlock Text="Connected" Foreground="#AAAAAA"/>
                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding !IsConnected}">
                                    <Ellipse Width="12" Height="12" Fill="#757575"/>
                                    <TextBlock Text="Disconnected" Foreground="#AAAAAA"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Bank Operations Section -->
                        <Border Background="#2D2D2D" Padding="16" CornerRadius="8">
                            <StackPanel Spacing="12">
                                <TextBlock Text="User Bank" 
                                           FontWeight="Bold" 
                                           FontSize="16"/>
                                
                                <TextBlock Text="Trigger 'Send Dump' from your Nova System pedal (UTILITY â†’ MIDI â†’ Send Dump)"
                                           Foreground="#888888"
                                           TextWrapping="Wrap"/>
                                
                                <Button Content="ðŸ“¥ Download User Bank"
                                        Command="{Binding DownloadBankCommand}"
                                        HorizontalAlignment="Left"
                                        Padding="16,8"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Preset List View -->
                        <views:PresetListView DataContext="{Binding PresetList}" />
                    </StackPanel>
                    
                    <!-- Right Side: Preset Detail View -->
                    <views:PresetDetailView Grid.Column="2" 
                                            DataContext="{Binding PresetDetail}" />
                </Grid>
            </TabItem>

            <!-- File Manager Tab -->
            <TabItem Header="ðŸ’¾ File Manager">
                <views:FileManagerView DataContext="{Binding FileManager}" />
            </TabItem>

            <!-- System Settings Tab -->
            <TabItem Header="âš™ï¸ System Settings">
                <views:SystemSettingsView DataContext="{Binding SystemSettings}" />
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
