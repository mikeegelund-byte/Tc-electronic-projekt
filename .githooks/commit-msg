#!/bin/bash
# Commit message validation
# Enforce conventional commit format

commitMsgFile=$1
commitMsg=$(cat "$commitMsgFile")

# Allow conventional commit format: type(scope): message
# Examples: feat(midi): add new parser, fix(ui): resolve layout bug
pattern="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{10,}"

if ! echo "$commitMsg" | grep -Eq "$pattern"; then
    echo "‚ùå Invalid commit message format!"
    echo ""
    echo "Commit messages must follow: type(scope): description"
    echo ""
    echo "Valid types:"
    echo "  feat     - New feature"
    echo "  fix      - Bug fix"
    echo "  docs     - Documentation only"
    echo "  refactor - Code change (no new feature or fix)"
    echo "  test     - Add/update tests"
    echo "  chore    - Maintenance tasks"
    echo ""
    echo "Example: feat(midi): add SysEx validation"
    echo ""
    echo "To bypass this check (not recommended): git commit --no-verify"
    exit 1
fi

exit 0
