<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Nova.Presentation.ViewModels"
             xmlns:effects="using:Nova.Presentation.Views.Effects"
             xmlns:converters="using:Nova.Presentation.Converters"
             x:Class="Nova.Presentation.Views.PresetDetailView"
             x:DataType="vm:PresetDetailViewModel">

    <UserControl.Resources>
        <converters:BoolToGreenGrayBrushConverter x:Key="BoolToGreenGrayBrushConverter"/>
    </UserControl.Resources>

    <Border Background="{StaticResource BackgroundSecondary}" 
            Padding="{StaticResource CardPadding}" 
            CornerRadius="{StaticResource BorderRadiusLarge}">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="{StaticResource Spacing16}">
                <!-- Header Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Preset Details" 
                               FontWeight="{StaticResource FontWeightBold}" 
                               FontSize="{StaticResource FontSizeLarge}"
                               Foreground="{StaticResource TextPrimary}"/>
                    
                    <StackPanel Spacing="4" IsVisible="{Binding HasPreset}">
                        <TextBlock FontSize="{StaticResource FontSizeXLarge}" 
                                   FontWeight="{StaticResource FontWeightBold}" 
                                   Foreground="{StaticResource TextPrimary}">
                            <Run Text="{Binding Position}"/> - <Run Text="{Binding PresetName}"/>
                        </TextBlock>
                        <TextBlock Text="{Binding PresetNumber, StringFormat='Preset #{0}'}" 
                                   Foreground="{StaticResource TextSecondary}"
                                   FontFamily="{StaticResource FontMonospace}"/>
                    </StackPanel>
                    
                    <TextBlock Text="Select a preset from the list to view details"
                               IsVisible="{Binding !HasPreset}"
                               Foreground="{StaticResource TextTertiary}"
                               FontStyle="Italic"
                               Margin="0,8,0,0"/>
                </StackPanel>

                <!-- Global Parameters Section -->
                <Border Background="{StaticResource BackgroundPrimary}" 
                        Padding="{StaticResource SpacingMedium}" 
                        CornerRadius="{StaticResource BorderRadiusMedium}"
                        IsVisible="{Binding HasPreset}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Global Parameters" 
                                   FontWeight="{StaticResource FontWeightBold}" 
                                   Foreground="{StaticResource TextPrimary}"
                                   Margin="0,0,0,4"/>
                        <Grid ColumnDefinitions="150,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto">
                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                       Text="Tap Tempo:" 
                                       Foreground="{StaticResource TextSecondary}"/>
                            <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Spacing="4">
                                <NumericUpDown Value="{Binding TapTempo}" 
                                               Minimum="100" Maximum="3000" 
                                               Increment="1" FormatString="N0"
                                               MinWidth="80" HorizontalAlignment="Left"
                                               AutomationProperties.Name="Tap tempo value"
                                               ToolTip.Tip="Tap tempo setting (100-3000 ms)" />
                                <TextBlock Text="ms" VerticalAlignment="Center" Foreground="{StaticResource TextTertiary}" />
                            </StackPanel>
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                       Text="Routing:" 
                                       Foreground="{StaticResource TextSecondary}"/>
                            <NumericUpDown Grid.Row="1" Grid.Column="1" 
                                           Value="{Binding Routing}" 
                                           Minimum="0" Maximum="2" 
                                           Increment="1" FormatString="N0"
                                           MinWidth="80" HorizontalAlignment="Left"
                                           AutomationProperties.Name="Signal routing configuration"
                                           ToolTip.Tip="Routing configuration (0=Semi, 1=Serial, 2=Parallel)" />
                            
                            <TextBlock Grid.Row="2" Grid.Column="0" 
                                       Text="Level Out Left:" 
                                       Foreground="{StaticResource TextSecondary}"/>
                            <StackPanel Grid.Row="2" Grid.Column="1" 
                                        Orientation="Horizontal" 
                                        Spacing="4">
                                <NumericUpDown Value="{Binding LevelOutLeft}" 
                                               Minimum="-100" Maximum="0" 
                                               Increment="1" FormatString="N0"
                                               MinWidth="80"
                                               AutomationProperties.Name="Level output left in decibels"
                                               ToolTip.Tip="Left channel output level (-100 to 0 dB)" />
                                <TextBlock Text="dB" 
                                           VerticalAlignment="Center" 
                                           Foreground="{StaticResource TextTertiary}" />
                            </StackPanel>
                            
                            <TextBlock Grid.Row="3" Grid.Column="0" 
                                       Text="Level Out Right:" 
                                       Foreground="{StaticResource TextSecondary}"/>
                            <StackPanel Grid.Row="3" Grid.Column="1" 
                                        Orientation="Horizontal" 
                                        Spacing="4">
                                <NumericUpDown Value="{Binding LevelOutRight}" 
                                               Minimum="-100" Maximum="0" 
                                               Increment="1" FormatString="N0"
                                               MinWidth="80"
                                               AutomationProperties.Name="Level output right in decibels"
                                               ToolTip.Tip="Right channel output level (-100 to 0 dB)" />
                                <TextBlock Text="dB" 
                                           VerticalAlignment="Center" 
                                           Foreground="{StaticResource TextTertiary}" />
                            </StackPanel>

                            <TextBlock Grid.Row="4" Grid.Column="0"
                                       Text="Map Parameter:"
                                       Foreground="{StaticResource TextSecondary}"/>
                            <NumericUpDown Grid.Row="4" Grid.Column="1"
                                           Value="{Binding MapParameter}"
                                           Minimum="0" Maximum="127"
                                           Increment="1" FormatString="N0"
                                           MinWidth="80" HorizontalAlignment="Left"
                                           ToolTip.Tip="Expression pedal mapped parameter (0-127)" />

                            <TextBlock Grid.Row="5" Grid.Column="0"
                                       Text="Map Min:"
                                       Foreground="{StaticResource TextSecondary}"/>
                            <StackPanel Grid.Row="5" Grid.Column="1" Orientation="Horizontal" Spacing="4">
                                <NumericUpDown Value="{Binding MapMin}"
                                               Minimum="0" Maximum="100"
                                               Increment="1" FormatString="N0"
                                               MinWidth="80" />
                                <TextBlock Text="%" VerticalAlignment="Center" Foreground="{StaticResource TextTertiary}" />
                            </StackPanel>

                            <TextBlock Grid.Row="6" Grid.Column="0"
                                       Text="Map Mid:"
                                       Foreground="{StaticResource TextSecondary}"/>
                            <StackPanel Grid.Row="6" Grid.Column="1" Orientation="Horizontal" Spacing="4">
                                <NumericUpDown Value="{Binding MapMid}"
                                               Minimum="0" Maximum="100"
                                               Increment="1" FormatString="N0"
                                               MinWidth="80" />
                                <TextBlock Text="%" VerticalAlignment="Center" Foreground="{StaticResource TextTertiary}" />
                            </StackPanel>

                            <TextBlock Grid.Row="7" Grid.Column="0"
                                       Text="Map Max:"
                                       Foreground="{StaticResource TextSecondary}"/>
                            <StackPanel Grid.Row="7" Grid.Column="1" Orientation="Horizontal" Spacing="4">
                                <NumericUpDown Value="{Binding MapMax}"
                                               Minimum="0" Maximum="100"
                                               Increment="1" FormatString="N0"
                                               MinWidth="80" />
                                <TextBlock Text="%" VerticalAlignment="Center" Foreground="{StaticResource TextTertiary}" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Routing Visualizer -->
                <Border Background="{StaticResource BackgroundPrimary}"
                        Padding="{StaticResource SpacingMedium}"
                        CornerRadius="{StaticResource BorderRadiusMedium}"
                        IsVisible="{Binding HasPreset}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Routing"
                                   FontWeight="{StaticResource FontWeightBold}"
                                   Foreground="{StaticResource TextPrimary}"/>

                        <StackPanel IsVisible="{Binding IsRoutingSerial}">
                            <TextBlock Text="Serial" Foreground="{StaticResource TextSecondary}"/>
                            <TextBlock Text="Input → Drive → Boost → Comp → Gate → EQ → Mod → Pitch → Delay → Reverb → Output"
                                       FontFamily="{StaticResource FontMonospace}"
                                       Foreground="{StaticResource TextTertiary}"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel IsVisible="{Binding IsRoutingSemiParallel}">
                            <TextBlock Text="Semi-Parallel" Foreground="{StaticResource TextSecondary}"/>
                            <TextBlock Text="Input → Drive → Boost → Comp → Gate → EQ → Mod → Pitch → ┬→ Delay →┐"
                                       FontFamily="{StaticResource FontMonospace}"
                                       Foreground="{StaticResource TextTertiary}"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="                                         └→ Reverb →┘"
                                       FontFamily="{StaticResource FontMonospace}"
                                       Foreground="{StaticResource TextTertiary}"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel IsVisible="{Binding IsRoutingParallel}">
                            <TextBlock Text="Parallel" Foreground="{StaticResource TextSecondary}"/>
                            <TextBlock Text="Input → Drive → Boost → Comp → Gate → EQ → ┬→ Mod →┐"
                                       FontFamily="{StaticResource FontMonospace}"
                                       Foreground="{StaticResource TextTertiary}"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="                                         ├→ Pitch →┤"
                                       FontFamily="{StaticResource FontMonospace}"
                                       Foreground="{StaticResource TextTertiary}"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="                                         ├→ Delay →┤"
                                       FontFamily="{StaticResource FontMonospace}"
                                       Foreground="{StaticResource TextTertiary}"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="                                         └→ Reverb →┘"
                                       FontFamily="{StaticResource FontMonospace}"
                                       Foreground="{StaticResource TextTertiary}"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Upload Preset Section -->
                <Border Background="{StaticResource BackgroundPrimary}" 
                        Padding="{StaticResource SpacingMedium}" 
                        CornerRadius="{StaticResource BorderRadiusMedium}"
                        IsVisible="{Binding HasPreset}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Upload Preset" 
                                   FontWeight="{StaticResource FontWeightBold}" 
                                   Foreground="{StaticResource TextPrimary}"/>
                        <Grid ColumnDefinitions="150,*,Auto" RowDefinitions="Auto">
                            <TextBlock Grid.Column="0" 
                                       Text="Target Slot:" 
                                       Foreground="{StaticResource TextSecondary}"
                                       VerticalAlignment="Center"/>
                            <NumericUpDown Grid.Column="1" 
                                           Value="{Binding TargetSlot}" 
                                           Minimum="1" Maximum="60" 
                                           Increment="1" FormatString="N0"
                                           MinWidth="80" HorizontalAlignment="Left"
                                           AutomationProperties.Name="Target slot number"
                                           ToolTip.Tip="Slot number to upload to (1-60)" />
                            <Button Grid.Column="2"
                                    Content="Upload to Pedal"
                                    Command="{Binding UploadPresetCommand}"
                                    Padding="{StaticResource ButtonPadding}"
                                    Margin="8,0,0,0"/>
                        </Grid>
                        <TextBlock Text="{Binding StatusMessage}"
                                   Foreground="{StaticResource TextSecondary}"
                                   TextWrapping="Wrap"
                                   IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                    </StackPanel>
                </Border>

                <StackPanel Spacing="{StaticResource Spacing16}" IsVisible="{Binding HasPreset}">
                    <effects:CompressorBlockView DataContext="{Binding Compressor}" />
                    <effects:DriveBlockView DataContext="{Binding Drive}" />
                    <effects:EqGateBlockView DataContext="{Binding EqGate}" />
                    <effects:ModulationBlockView DataContext="{Binding Modulation}" />
                    <effects:PitchBlockView DataContext="{Binding Pitch}" />
                    <effects:DelayBlockView DataContext="{Binding Delay}" />
                    <effects:ReverbBlockView DataContext="{Binding Reverb}" />
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Border>
</UserControl>
